<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KCET Physics Mock Test</title>
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="theme-color" content="#007bff">
    <style>
        :root {
            --primary: #007bff;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            margin: 0; padding: 0; background: #f4f6f9; color: #333;
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
            user-select: none;
        }

        /* --- HEADER --- */
        .test-header {
            background: white; padding: 0 20px; border-bottom: 1px solid #ddd;
            display: flex; justify-content: space-between; align-items: center;
            height: 60px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 10;
        }
        .timer-box {
            font-size: 1.2rem; font-weight: bold; color: var(--danger);
            background: #fff0f0; padding: 5px 15px; border-radius: 5px; border: 1px solid #ffcccc;
            min-width: 80px; text-align: center;
        }
        .submit-btn {
            background: var(--success); color: white; border: none; padding: 10px 20px;
            border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .submit-btn:hover { background: #218838; }

        /* --- MAIN LAYOUT --- */
        .test-container {
            display: flex; flex: 1; overflow: hidden; position: relative;
        }

        /* Question Area */
        .question-area {
            flex: 1; padding: 20px; overflow-y: auto;
            display: flex; flex-direction: column; max-width: 100%;
        }
        .q-card {
            background: white; padding: 25px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }
        .q-header {
            display: flex; justify-content: space-between; margin-bottom: 15px;
            border-bottom: 1px solid #eee; padding-bottom: 10px;
        }
        .q-badge {
            background: var(--primary); color: white; padding: 2px 8px; 
            border-radius: 4px; font-size: 0.8rem; font-weight: bold;
        }
        .q-text { font-size: 1.15rem; font-weight: 600; margin-bottom: 25px; line-height: 1.6; }
        
        /* Options */
        .option-btn {
            display: flex; align-items: center; width: 100%; text-align: left; padding: 15px;
            margin-bottom: 12px; border: 2px solid #eee; border-radius: 8px;
            background: white; cursor: pointer; transition: 0.2s;
            font-size: 1rem; position: relative;
        }
        .option-btn:hover { background: #f8f9fa; border-color: #ccc; }
        
        /* Default Selected State (During Test) */
        .option-btn.selected { 
            border-color: var(--primary); background: #e7f1ff; color: var(--primary); font-weight: 600; 
        }

        /* Review Mode States */
        .option-btn.correct-ans {
            border-color: var(--success); background: #d4edda; color: #155724; font-weight: bold;
        }
        .option-btn.correct-ans::after { content: ' (Correct Answer)'; font-size: 0.8rem; margin-left: auto; font-weight: normal; color: #155724; }
        
        .option-btn.wrong-ans {
            border-color: var(--danger); background: #f8d7da; color: #721c24; font-weight: bold;
        }
        .option-btn.wrong-ans::after { content: ' (Your Answer)'; font-size: 0.8rem; margin-left: auto; font-weight: normal; color: #721c24; }


        .option-circle {
            width: 24px; height: 24px; border: 2px solid #ccc; border-radius: 50%;
            margin-right: 15px; display: flex; justify-content: center; align-items: center;
        }
        .option-btn.selected .option-circle {
            border-color: var(--primary); background: var(--primary);
        }
        .option-btn.selected .option-circle::after {
            content: '✓'; color: white; font-size: 0.8rem;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: auto; padding-top: 10px;
        }
        .nav-btn {
            padding: 12px 25px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold;
            background: #6c757d; color: white; transition: 0.2s;
        }
        .nav-btn.next { background: var(--primary); }
        .nav-btn:hover { opacity: 0.9; }
        .nav-btn:disabled { background: #e9ecef; color: #adb5bd; cursor: not-allowed; }

        /* Sidebar (Question Palette) */
        .sidebar {
            width: 320px; background: white; border-left: 1px solid #ddd;
            display: flex; flex-direction: column; transition: transform 0.3s ease;
            position: relative; z-index: 20;
        }
        .sidebar-header {
            padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee;
            font-weight: bold; text-align: center; color: #555;
        }
        
        /* Legend */
        .legend {
            display: flex; justify-content: space-around; padding: 10px; border-bottom: 1px solid #eee; font-size: 0.75rem;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        
        .palette-grid {
            padding: 15px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
            overflow-y: auto; flex: 1; align-content: start;
        }
        .p-btn {
            width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ddd;
            background: white; cursor: pointer; font-weight: bold; color: #555;
            display: flex; justify-content: center; align-items: center; font-size: 0.9rem;
        }
        .p-btn:hover { background: #f0f0f0; }
        
        /* Palette States */
        .p-btn.current { border: 2px solid var(--primary); color: var(--primary); }
        .p-btn.answered { background: var(--success); color: white; border-color: var(--success); }
        .p-btn.review { background: var(--warning); color: black; border-color: var(--warning); }
        .p-btn.review-ans { background: #6610f2; color: white; border-color: #6610f2; } /* Answered & Marked for Review */
        
        /* Review Mode Palette */
        .p-btn.p-correct { background: var(--success); color: white; border-color: var(--success); }
        .p-btn.p-wrong { background: var(--danger); color: white; border-color: var(--danger); }
        .p-btn.p-skip { background: #e9ecef; color: #666; }

        /* Mobile Toggle */
        .mobile-toggle { display: none; background: transparent; border: none; font-size: 1.5rem; cursor: pointer; }
        .mobile-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 15;
        }

        /* RESULT OVERLAY */
        #result-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: white; z-index: 100; display: none;
            flex-direction: column; align-items: center; justify-content: center; overflow-y: auto; padding: 20px;
        }
        .score-card {
            background: white; padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center;
            border: 1px solid #eee; width: 90%; max-width: 450px;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: auto;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .score-circle {
            width: 140px; height: 140px; border-radius: 50%;
            background: conic-gradient(var(--success) 0%, #eee 0); 
            display: flex; justify-content: center; align-items: center;
            margin: 0 auto 25px; position: relative;
        }
        .score-inner {
            width: 120px; height: 120px; background: white; border-radius: 50%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .score-big { font-size: 2.5rem; font-weight: 800; color: var(--dark); }
        .score-total { font-size: 0.9rem; color: #666; }

        .stat-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;
        }
        .stat-box {
            background: #f8f9fa; padding: 15px; border-radius: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed; right: -320px; top: 60px; bottom: 0; height: calc(100% - 60px);
            }
            .sidebar.open { transform: translateX(-320px); }
            .mobile-toggle { display: block; }
            .test-header { padding: 0 10px; }
            .timer-box { font-size: 1rem; min-width: 60px; padding: 5px 10px; }
            .submit-btn { padding: 8px 15px; font-size: 0.9rem; }
            .mobile-overlay.active { display: block; }
        }

    </style>
</head>
<body>

    <div class="test-header">
        <div style="display:flex; align-items:center;">
            <a href="index.html" onclick="if(!isReviewMode) return confirm('Exit test? Progress will be lost.');" style="text-decoration:none; color:#333; margin-right:15px; font-weight:bold; font-size: 1.2rem;">✕</a>
            <h3 style="margin:0; font-size:1.1rem; display: flex; flex-direction: column;">
                <span>Physics</span>
                <span style="font-size:0.7rem; color:#666; font-weight:normal;">Paper I</span>
            </h3>
        </div>
        
        <div class="timer-box" id="timer">80:00</div>
        
        <div style="display:flex; gap:15px; align-items: center;">
            <button class="submit-btn" id="submit-btn-top" onclick="submitTest()">Submit</button>
            <button class="mobile-toggle" onclick="toggleSidebar()">☰</button>
        </div>
    </div>

    <div class="mobile-overlay" onclick="toggleSidebar()"></div>

    <div class="test-container">
        
        <div class="question-area">
            <div class="q-card">
                <div class="q-header">
                    <span style="color:#666; font-weight:600;">Question <span id="q-num">1</span> of 60</span>
                    <span class="q-badge" id="mark-badge">+1 Mark</span>
                </div>
                <div class="q-text" id="q-content">Loading Question...</div>
                <div id="options-container">
                    </div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn" id="prev-btn" onclick="changeQuestion(-1)">Previous</button>
                <button class="nav-btn" id="review-btn" style="background: #ffc107; color: #000;" onclick="markForReview()">Mark for Review</button>
                <button class="nav-btn next" id="next-btn" onclick="changeQuestion(1)">Save & Next</button>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">Question Palette</div>
            <div class="legend">
                <div class="legend-item"><div class="dot" style="background:var(--success)"></div> Ans</div>
                <div class="legend-item"><div class="dot" style="background:white; border:1px solid #ddd"></div> Unread</div>
                <div class="legend-item"><div class="dot" style="background:var(--warning)"></div> Review</div>
            </div>
            <div class="palette-grid" id="palette-container">
                </div>
        </div>
    </div>

    <div id="result-overlay">
        <div class="score-card">
            <h2 style="margin:0 0 20px 0; color:var(--dark);">Test Summary</h2>
            
            <div class="score-circle" id="score-ring">
                <div class="score-inner">
                    <span class="score-big" id="final-score">0</span>
                    <span class="score-total">/ 60</span>
                </div>
            </div>

            <div class="stat-grid">
                <div class="stat-box">
                    <div style="color:var(--success); font-weight:bold; font-size:1.2rem;" id="correct-count">0</div>
                    <div style="font-size:0.8rem; color:#666;">Correct</div>
                </div>
                <div class="stat-box">
                    <div style="color:var(--danger); font-weight:bold; font-size:1.2rem;" id="wrong-count">0</div>
                    <div style="font-size:0.8rem; color:#666;">Wrong</div>
                </div>
                <div class="stat-box">
                    <div style="color:#666; font-weight:bold; font-size:1.2rem;" id="unattempted-count">0</div>
                    <div style="font-size:0.8rem; color:#666;">Skipped</div>
                </div>
                <div class="stat-box">
                    <div style="color:var(--primary); font-weight:bold; font-size:1.2rem;" id="accuracy-txt">0%</div>
                    <div style="font-size:0.8rem; color:#666;">Accuracy</div>
                </div>
            </div>

            <button class="submit-btn" style="width:100%; margin-top:20px; padding:15px; background:var(--primary);" onclick="startReviewMode()">View Detailed Analysis</button>
            <button class="submit-btn" style="width:100%; margin-top:10px; padding:15px; background:white; color:var(--dark); border:1px solid #ddd;" onclick="location.href='index.html'">Return to Dashboard</button>
        </div>
    </div>

    <script>
        // --- 1. REAL KCET PHYSICS QUESTIONS (60 QUESTIONS) ---
        const questions = [
            // Units & Motion (1-5)
            { q: "The dimensional formula for Impulse is:", o: ["[MLT⁻²]", "[MLT⁻¹]", "[ML²T⁻²]", "[ML⁻¹T⁻¹]"], a: 1 },
            { q: "Which of the following is not a unit of time?", o: ["Leap year", "Micro second", "Lunar month", "Parallactic second"], a: 3 },
            { q: "A body starts from rest and moves with constant acceleration. The ratio of distance covered in nth second to that in n seconds is:", o: ["2/n - 1/n²", "1/n² - 1/n", "2/n - 1/n", "2/n² - 1/n"], a: 0 },
            { q: "The area under velocity-time graph represents:", o: ["Force", "Displacement", "Distance", "Acceleration"], a: 1 },
            { q: "A ball is thrown vertically upwards with velocity 20 m/s. (g=10). Max height is:", o: ["10 m", "20 m", "40 m", "5 m"], a: 1 },
            
            // Motion in Plane & Laws (6-10)
            { q: "Maximum range of a projectile is obtained when angle of projection is:", o: ["30°", "45°", "60°", "90°"], a: 1 },
            { q: "A cyclist bends while taking a turn to:", o: ["Reduce friction", "Generate centripetal force", "Reduce speed", "Increase weight"], a: 1 },
            { q: "Inertia of a body depends directly on:", o: ["Velocity", "Area", "Volume", "Mass"], a: 3 },
            { q: "Rocket propulsion is based on conservation of:", o: ["Mass", "Energy", "Linear Momentum", "Angular Momentum"], a: 2 },
            { q: "A block of mass 2kg is placed on floor (μ=0.5). Force of 5N applied horizontally. Friction force is:", o: ["10N", "5N", "2N", "Zero"], a: 1 },

            // Work Energy & Rotation (11-15)
            { q: "If momentum is increased by 20%, KE increases by:", o: ["44%", "20%", "40%", "10%"], a: 0 },
            { q: "Work done by centripetal force is:", o: ["Unity", "Zero", "Positive", "Negative"], a: 1 },
            { q: "Moment of Inertia of a disc about its diameter is:", o: ["MR²", "MR²/2", "MR²/4", "2MR²/5"], a: 2 },
            { q: "Angular momentum is conserved if:", o: ["Force is zero", "Torque is zero", "Velocity is zero", "Energy is zero"], a: 1 },
            { q: "Radius of gyration depends on:", o: ["Mass", "Axis of rotation", "Shape", "All of these"], a: 1 },

            // Gravitation & Solids (16-20)
            { q: "Escape velocity on Earth is 11.2 km/s. If mass of planet is 4 times and radius 4 times that of Earth, escape velocity is:", o: ["11.2 km/s", "22.4 km/s", "5.6 km/s", "1.12 km/s"], a: 0 },
            { q: "Value of g at the center of Earth is:", o: ["9.8", "Infinity", "Zero", "Variable"], a: 2 },
            { q: "Young's modulus of a perfectly rigid body is:", o: ["Zero", "1", "Infinity", "0.5"], a: 2 },
            { q: "Hydraulic lift works on:", o: ["Pascal's Law", "Bernoulli's Principle", "Archimedes Principle", "Boyle's Law"], a: 0 },
            { q: "Raindrops are spherical due to:", o: ["Viscosity", "Gravity", "Surface Tension", "Air friction"], a: 2 },

            // Thermal & Thermo (21-25)
            { q: "Water has maximum density at:", o: ["0°C", "100°C", "4°C", "-4°C"], a: 2 },
            { q: "First law of thermodynamics is conservation of:", o: ["Heat", "Work", "Momentum", "Energy"], a: 3 },
            { q: "In an adiabatic process:", o: ["ΔT=0", "ΔQ=0", "ΔP=0", "ΔV=0"], a: 1 },
            { q: "Efficiency of Carnot engine working between 300K and 600K is:", o: ["50%", "100%", "25%", "75%"], a: 0 },
            { q: "Specific heat at constant pressure (Cp) is greater than Cv because:", o: ["Work is done in expansion", "Work is done in compression", "No work is done", "Gas heats up faster"], a: 0 },

            // SHM & Waves (26-30)
            { q: "Time period of a seconds pendulum is:", o: ["1 s", "2 s", "0.5 s", "4 s"], a: 1 },
            { q: "Velocity of sound is maximum in:", o: ["Air", "Water", "Vacuum", "Steel"], a: 3 },
            { q: "Doppler effect is applicable to:", o: ["Sound only", "Light only", "Both", "None"], a: 2 },
            { q: "Beats are produced due to:", o: ["Reflection", "Interference", "Diffraction", "Polarization"], a: 1 },
            { q: "Equation of SHM is x = 5 sin(20t + π/3). Amplitude is:", o: ["20", "5", "10", "15"], a: 1 },

            // Electrostatics (31-35)
            { q: "SI unit of Electric Field intensity is:", o: ["N/C", "V/m", "J/C", "Both N/C and V/m"], a: 3 },
            { q: "Electric flux through a closed surface containing charge q is:", o: ["q/ε₀", "qε₀", "Zero", "q²"], a: 0 },
            { q: "Energy stored in a capacitor is given by:", o: ["CV", "½ CV²", "½ QV²", "Q/V"], a: 1 },
            { q: "Dielectric constant for a metal is:", o: ["Zero", "One", "Infinity", "Negative"], a: 2 },
            { q: "Equipotential surface for a point charge is:", o: ["Planar", "Cylindrical", "Spherical", "Elliptical"], a: 2 },

            // Current Electricity (36-40)
            { q: "Kirchhoff's first law (Junction rule) is based on conservation of:", o: ["Energy", "Charge", "Momentum", "Mass"], a: 1 },
            { q: "Resistance of a wire depends on:", o: ["Length", "Area", "Material", "All of these"], a: 3 },
            { q: "If length of a wire is doubled by stretching, resistance becomes:", o: ["2 times", "4 times", "Half", "Same"], a: 1 },
            { q: "Drift velocity is of the order of:", o: ["mm/s", "m/s", "km/s", "speed of light"], a: 0 },
            { q: "Potentiometer is preferred over voltmeter because:", o: ["It's cheaper", "It draws no current at null point", "It is portable", "It has low resistance"], a: 1 },

            // Magnetism (41-45)
            { q: "Magnetic field inside a solenoid is:", o: ["Zero", "Uniform", "Non-uniform", "Variable"], a: 1 },
            { q: "Force on a moving charge in magnetic field is zero when angle is:", o: ["0°", "90°", "45°", "60°"], a: 0 },
            { q: "Unit of Magnetic Flux is:", o: ["Tesla", "Weber", "Gauss", "Ampere"], a: 1 },
            { q: "Curie temperature is the temperature above which:", o: ["Ferro becomes Para", "Para becomes Dia", "Ferro becomes Dia", "Material melts"], a: 0 },
            { q: "Lenz's law is a consequence of conservation of:", o: ["Charge", "Momentum", "Energy", "Mass"], a: 2 },

            // AC & EM Waves (46-50)
            { q: "In a pure inductive circuit, current:", o: ["Leads voltage by 90°", "Lags voltage by 90°", "In phase", "Lags by 45°"], a: 1 },
            { q: "Power factor at resonance is:", o: ["Zero", "0.5", "1", "Infinity"], a: 2 },
            { q: "Transformer works on the principle of:", o: ["Self Induction", "Mutual Induction", "Eddy Currents", "Lorentz Force"], a: 1 },
            { q: "Which EM wave has the highest frequency?", o: ["Radio", "Visible", "X-Rays", "Gamma Rays"], a: 3 },
            { q: "Displacement current arises due to:", o: ["Flow of electrons", "Changing Electric Field", "Changing Magnetic Field", "Heat"], a: 1 },

            // Optics (51-55)
            { q: "Focal length of a plane mirror is:", o: ["Zero", "Infinity", "1", "-1"], a: 1 },
            { q: "Mirage is due to:", o: ["Reflection", "Refraction", "Total Internal Reflection", "Diffraction"], a: 2 },
            { q: "Sky appears blue due to:", o: ["Scattering", "Dispersion", "Interference", "Reflection"], a: 0 },
            { q: "Wave nature of light was verified by:", o: ["Photoelectric effect", "Interference", "Reflection", "Refraction"], a: 1 },
            { q: "Resolving power of telescope increases when:", o: ["Aperture increases", "Wavelength increases", "Focal length increases", "None"], a: 0 },

            // Modern Physics (56-60)
            { q: "Photoelectric effect supports:", o: ["Wave nature", "Particle nature", "Both", "None"], a: 1 },
            { q: "Energy of a photon is:", o: ["hλ", "hc/λ", "h/cλ", "λ/hc"], a: 1 },
            { q: "Lyman series lies in:", o: ["Visible region", "UV region", "IR region", "Microwave"], a: 1 },
            { q: "Isotopes have same number of:", o: ["Neutrons", "Protons", "Nucleons", "Positrons"], a: 1 },
            { q: "In a p-type semiconductor, majority carriers are:", o: ["Electrons", "Holes", "Neutrons", "Protons"], a: 1 }
        ];

        // --- 2. STATE VARIABLES ---
        let currentQ = 0;
        let answers = new Array(60).fill(null); // Stores user answers (index)
        let status = new Array(60).fill(0); // 0:Unread, 1:Visited, 2:Answered, 3:Review
        let timerTime = 80 * 60; // 80 mins in seconds
        let timerInterval;
        let isReviewMode = false;

        // --- 3. INIT ---
        window.onload = function() {
            renderPalette();
            loadQuestion(0);
            startTimer();
            status[0] = 1; // Visited first q
            updatePaletteBtn(0);
        };

        // --- 4. TIMER ---
        function startTimer() {
            timerInterval = setInterval(() => {
                timerTime--;
                let m = Math.floor(timerTime / 60);
                let s = timerTime % 60;
                document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                
                if (timerTime <= 0) {
                    clearInterval(timerInterval);
                    alert("Time's Up! Submitting automatically.");
                    submitTest();
                }
            }, 1000);
        }

        // --- 5. RENDER FUNCTIONS ---
        function loadQuestion(index) {
            currentQ = index;
            document.getElementById('q-num').innerText = index + 1;
            
            // Render Text
            document.getElementById('q-content').innerText = questions[index].q;
            
            // Render Options
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            questions[index].o.forEach((opt, i) => {
                const btn = document.createElement('div');
                let className = 'option-btn';
                
                // Normal Mode Styling
                if (!isReviewMode) {
                    if (answers[index] === i) className += ' selected';
                } 
                // Review Mode Styling
                else {
                    const correctIndex = questions[index].a;
                    const userIndex = answers[index];

                    if (i === correctIndex) {
                        className += ' correct-ans';
                    } else if (i === userIndex) {
                        className += ' wrong-ans';
                    }
                }
                
                btn.className = className;
                btn.innerHTML = `<div class="option-circle"></div> ${opt}`;
                
                // Only allow click if NOT in review mode
                if (!isReviewMode) {
                    btn.onclick = () => selectOption(i);
                }
                
                container.appendChild(btn);
            });

            // Update Nav Buttons
            document.getElementById('prev-btn').disabled = (index === 0);
            document.getElementById('next-btn').innerText = (index === 59) ? (isReviewMode ? 'Finish Review' : 'Submit') : 'Next';
            
            // Update status if unread
            if(status[index] === 0 && !isReviewMode) status[index] = 1;
            renderPalette();
        }

        function renderPalette() {
            const container = document.getElementById('palette-container');
            container.innerHTML = '';
            
            for(let i=0; i<60; i++) {
                const btn = document.createElement('div');
                btn.className = 'p-btn';
                btn.innerText = i + 1;
                
                // Set Color Class
                if(i === currentQ) btn.classList.add('current');
                
                if (isReviewMode) {
                    // Review Mode: Green if correct, Red if wrong
                    if (answers[i] === questions[i].a) btn.classList.add('p-correct'); // Green
                    else if (answers[i] !== null) btn.classList.add('p-wrong'); // Red
                    else btn.classList.add('p-skip'); // Skipped
                } else {
                    // Test Mode
                    if(status[i] === 3) btn.classList.add(answers[i] !== null ? 'review-ans' : 'review');
                    else if(answers[i] !== null) btn.classList.add('answered');
                }
                
                btn.onclick = () => loadQuestion(i);
                container.appendChild(btn);
            }
        }

        function updatePaletteBtn(index) {
            renderPalette();
        }

        // --- 6. INTERACTION ---
        function selectOption(optIndex) {
            if(isReviewMode) return; // Locked
            answers[currentQ] = optIndex;
            // Highlight locally
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.classList.remove('selected'));
            btns[optIndex].classList.add('selected');
        }

        function changeQuestion(dir) {
            // Save status for current
            if (!isReviewMode) {
                if (answers[currentQ] !== null) {
                    if(status[currentQ] !== 3) status[currentQ] = 2; // Answered
                } else {
                    if(status[currentQ] !== 3) status[currentQ] = 1; // Visited
                }
            }

            let next = currentQ + dir;
            if (next >= 0 && next < 60) {
                loadQuestion(next);
            } else if (next === 60) {
                if(isReviewMode) location.href = 'index.html'; // Finish Review
                else submitTest();
            }
        }

        function markForReview() {
            if(isReviewMode) return;
            status[currentQ] = 3;
            changeQuestion(1);
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            sidebar.classList.toggle('open');
            if(sidebar.classList.contains('open')) overlay.style.display = 'block';
            else overlay.style.display = 'none';
        }

        // --- 7. SUBMISSION & REVIEW ---
        function submitTest() {
            clearInterval(timerInterval);
            let score = 0;
            let correct = 0;
            let wrong = 0;
            let unattempted = 0;

            for(let i=0; i<60; i++) {
                if(answers[i] === null) {
                    unattempted++;
                } else if(answers[i] === questions[i].a) {
                    score++;
                    correct++;
                } else {
                    wrong++;
                }
            }

            // Show Result
            document.getElementById('final-score').innerText = score;
            document.getElementById('correct-count').innerText = correct;
            document.getElementById('wrong-count').innerText = wrong;
            document.getElementById('unattempted-count').innerText = unattempted;
            
            let accuracy = (correct + wrong) > 0 ? Math.round((correct / (correct+wrong)) * 100) : 0;
            document.getElementById('accuracy-txt').innerText = accuracy + '%';

            // Animate Ring
            const pct = (score / 60) * 100;
            document.getElementById('score-ring').style.background = `conic-gradient(var(--success) ${pct}%, #eee 0)`;

            document.getElementById('result-overlay').style.display = 'flex';
        }

        function startReviewMode() {
            document.getElementById('result-overlay').style.display = 'none';
            isReviewMode = true;
            
            // UI Changes for Review Mode
            document.getElementById('submit-btn-top').style.display = 'none';
            document.getElementById('timer').innerText = "REVIEW";
            document.getElementById('timer').style.background = "#e2e6ea";
            document.getElementById('timer').style.color = "#333";
            document.getElementById('review-btn').style.display = 'none';
            document.getElementById('mark-badge').style.display = 'none';

            // Update Palette Colors to Red/Green
            renderPalette();
            loadQuestion(0);
        }

    </script>
</body>
</html>