<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KCET Chemistry Mock Test</title>
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="theme-color" content="#6f42c1">
    <style>
        :root {
            --primary: #6f42c1; /* Purple */
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            margin: 0; padding: 0; background: #f4f6f9; color: #333;
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
            user-select: none;
        }

        /* --- HEADER --- */
        .test-header {
            background: white; padding: 0 20px; border-bottom: 1px solid #ddd;
            display: flex; justify-content: space-between; align-items: center;
            height: 60px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 10;
        }
        .timer-box {
            font-size: 1.2rem; font-weight: bold; color: var(--danger);
            background: #fff0f0; padding: 5px 15px; border-radius: 5px; border: 1px solid #ffcccc;
            min-width: 80px; text-align: center;
        }
        .submit-btn {
            background: var(--success); color: white; border: none; padding: 10px 20px;
            border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .submit-btn:hover { background: #218838; }

        /* --- MAIN LAYOUT --- */
        .test-container {
            display: flex; flex: 1; overflow: hidden; position: relative;
        }

        /* Question Area */
        .question-area {
            flex: 1; padding: 20px; overflow-y: auto;
            display: flex; flex-direction: column; max-width: 100%;
        }
        .q-card {
            background: white; padding: 25px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }
        .q-header {
            display: flex; justify-content: space-between; margin-bottom: 15px;
            border-bottom: 1px solid #eee; padding-bottom: 10px;
        }
        .q-badge {
            background: var(--primary); color: white; padding: 2px 8px; 
            border-radius: 4px; font-size: 0.8rem; font-weight: bold;
        }
        .q-text { font-size: 1.15rem; font-weight: 600; margin-bottom: 25px; line-height: 1.6; }
        
        /* Options */
        .option-btn {
            display: flex; align-items: center; width: 100%; text-align: left; padding: 15px;
            margin-bottom: 12px; border: 2px solid #eee; border-radius: 8px;
            background: white; cursor: pointer; transition: 0.2s;
            font-size: 1rem; position: relative;
        }
        .option-btn:hover { background: #f8f9fa; border-color: #ccc; }
        
        /* Selection State (During Test) */
        .option-btn.selected { 
            border-color: var(--primary); background: #f3e5f5; color: var(--primary); font-weight: 600; 
        }

        /* Review Mode States */
        .option-btn.correct-ans {
            border-color: var(--success); background: #d4edda; color: #155724; font-weight: bold;
        }
        .option-btn.correct-ans::after { content: ' (Correct Answer)'; font-size: 0.8rem; margin-left: auto; font-weight: normal; color: #155724; }
        
        .option-btn.wrong-ans {
            border-color: var(--danger); background: #f8d7da; color: #721c24; font-weight: bold;
        }
        .option-btn.wrong-ans::after { content: ' (Your Answer)'; font-size: 0.8rem; margin-left: auto; font-weight: normal; color: #721c24; }

        .option-circle {
            width: 24px; height: 24px; border: 2px solid #ccc; border-radius: 50%;
            margin-right: 15px; display: flex; justify-content: center; align-items: center;
        }
        .option-btn.selected .option-circle {
            border-color: var(--primary); background: var(--primary);
        }
        .option-btn.selected .option-circle::after {
            content: '✓'; color: white; font-size: 0.8rem;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: auto; padding-top: 10px;
        }
        .nav-btn {
            padding: 12px 25px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold;
            background: #6c757d; color: white; transition: 0.2s;
        }
        .nav-btn.next { background: var(--primary); }
        .nav-btn:hover { opacity: 0.9; }
        .nav-btn:disabled { background: #e9ecef; color: #adb5bd; cursor: not-allowed; }

        /* Sidebar (Question Palette) */
        .sidebar {
            width: 320px; background: white; border-left: 1px solid #ddd;
            display: flex; flex-direction: column; transition: transform 0.3s ease;
            position: relative; z-index: 20;
        }
        .sidebar-header {
            padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee;
            font-weight: bold; text-align: center; color: #555;
        }
        
        /* Legend */
        .legend {
            display: flex; justify-content: space-around; padding: 10px; border-bottom: 1px solid #eee; font-size: 0.75rem;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        
        .palette-grid {
            padding: 15px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
            overflow-y: auto; flex: 1; align-content: start;
        }
        .p-btn {
            width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ddd;
            background: white; cursor: pointer; font-weight: bold; color: #555;
            display: flex; justify-content: center; align-items: center; font-size: 0.9rem;
        }
        .p-btn:hover { background: #f0f0f0; }
        
        /* Palette States */
        .p-btn.current { border: 2px solid var(--primary); color: var(--primary); }
        .p-btn.answered { background: var(--success); color: white; border-color: var(--success); }
        .p-btn.review { background: var(--warning); color: black; border-color: var(--warning); }
        .p-btn.review-ans { background: #6610f2; color: white; border-color: #6610f2; }

        /* Review Mode Palette */
        .p-btn.p-correct { background: var(--success); color: white; border-color: var(--success); }
        .p-btn.p-wrong { background: var(--danger); color: white; border-color: var(--danger); }
        .p-btn.p-skip { background: #e9ecef; color: #666; }

        /* Mobile Toggle */
        .mobile-toggle { display: none; background: transparent; border: none; font-size: 1.5rem; cursor: pointer; }
        .mobile-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 15;
        }

        /* RESULT OVERLAY */
        #result-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: white; z-index: 100; display: none;
            flex-direction: column; align-items: center; justify-content: center; overflow-y: auto; padding: 20px;
        }
        .score-card {
            background: white; padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center;
            border: 1px solid #eee; width: 90%; max-width: 450px;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: auto;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .score-circle {
            width: 140px; height: 140px; border-radius: 50%;
            background: conic-gradient(var(--success) 0%, #eee 0); 
            display: flex; justify-content: center; align-items: center;
            margin: 0 auto 25px; position: relative;
        }
        .score-inner {
            width: 120px; height: 120px; background: white; border-radius: 50%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .score-big { font-size: 2.5rem; font-weight: 800; color: var(--dark); }
        .score-total { font-size: 0.9rem; color: #666; }

        .stat-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;
        }
        .stat-box {
            background: #f8f9fa; padding: 15px; border-radius: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed; right: -320px; top: 60px; bottom: 0; height: calc(100% - 60px);
            }
            .sidebar.open { transform: translateX(-320px); }
            .mobile-toggle { display: block; }
            .test-header { padding: 0 10px; }
            .timer-box { font-size: 1rem; min-width: 60px; padding: 5px 10px; }
            .submit-btn { padding: 8px 15px; font-size: 0.9rem; }
            .mobile-overlay.active { display: block; }
        }

    </style>
</head>
<body>

    <div class="test-header">
        <div style="display:flex; align-items:center;">
            <a href="index.html" onclick="if(!isReviewMode) return confirm('Exit test? Progress will be lost.');" style="text-decoration:none; color:#333; margin-right:15px; font-weight:bold; font-size: 1.2rem;">✕</a>
            <h3 style="margin:0; font-size:1.1rem; display: flex; flex-direction: column;">
                <span>Chemistry</span>
                <span style="font-size:0.7rem; color:#666; font-weight:normal;">Paper II</span>
            </h3>
        </div>
        
        <div class="timer-box" id="timer">80:00</div>
        
        <div style="display:flex; gap:15px; align-items: center;">
            <button class="submit-btn" id="submit-btn-top" onclick="submitTest()">Submit</button>
            <button class="mobile-toggle" onclick="toggleSidebar()">☰</button>
        </div>
    </div>

    <div class="mobile-overlay" onclick="toggleSidebar()"></div>

    <div class="test-container">
        
        <div class="question-area">
            <div class="q-card">
                <div class="q-header">
                    <span style="color:#666; font-weight:600;">Question <span id="q-num">1</span> of 60</span>
                    <span class="q-badge" id="mark-badge">+1 Mark</span>
                </div>
                <div class="q-text" id="q-content">Loading Question...</div>
                <div id="options-container">
                    </div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn" id="prev-btn" onclick="changeQuestion(-1)">Previous</button>
                <button class="nav-btn" id="review-btn" style="background: #ffc107; color: #000;" onclick="markForReview()">Mark for Review</button>
                <button class="nav-btn next" id="next-btn" onclick="changeQuestion(1)">Save & Next</button>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">Question Palette</div>
            <div class="legend">
                <div class="legend-item"><div class="dot" style="background:var(--success)"></div> Ans</div>
                <div class="legend-item"><div class="dot" style="background:white; border:1px solid #ddd"></div> Unread</div>
                <div class="legend-item"><div class="dot" style="background:var(--warning)"></div> Review</div>
            </div>
            <div class="palette-grid" id="palette-container">
                </div>
        </div>
    </div>

    <div id="result-overlay">
        <div class="score-card">
            <h2 style="margin:0 0 20px 0; color:var(--dark);">Test Summary</h2>
            
            <div class="score-circle" id="score-ring">
                <div class="score-inner">
                    <span class="score-big" id="final-score">0</span>
                    <span class="score-total">/ 60</span>
                </div>
            </div>

            <div class="stat-grid">
                <div class="stat-box">
                    <div style="color:var(--success); font-weight:bold; font-size:1.2rem;" id="correct-count">0</div>
                    <div style="font-size:0.8rem; color:#666;">Correct</div>
                </div>
                <div class="stat-box">
                    <div style="color:var(--danger); font-weight:bold; font-size:1.2rem;" id="wrong-count">0</div>
                    <div style="font-size:0.8rem; color:#666;">Wrong</div>
                </div>
                <div class="stat-box">
                    <div style="color:#666; font-weight:bold; font-size:1.2rem;" id="unattempted-count">0</div>
                    <div style="font-size:0.8rem; color:#666;">Skipped</div>
                </div>
                <div class="stat-box">
                    <div style="color:var(--primary); font-weight:bold; font-size:1.2rem;" id="accuracy-txt">0%</div>
                    <div style="font-size:0.8rem; color:#666;">Accuracy</div>
                </div>
            </div>

            <button class="submit-btn" style="width:100%; margin-top:20px; padding:15px; background:var(--primary);" onclick="startReviewMode()">View Detailed Analysis</button>
            <button class="submit-btn" style="width:100%; margin-top:10px; padding:15px; background:white; color:var(--dark); border:1px solid #ddd;" onclick="location.href='index.html'">Return to Dashboard</button>
        </div>
    </div>

    <script>
        // --- 1. REAL KCET CHEMISTRY QUESTIONS (60 QUESTIONS) ---
        const questions = [
            // Class 11 Physical & Inorganic (1-15)
            { q: "Which of the following has the highest number of atoms?", o: ["1g Au (s)", "1g Na (s)", "1g Li (s)", "1g Cl2 (g)"], a: 2 },
            { q: "The correct set of four quantum numbers for the valence electron of rubidium atom (Z=37) is:", o: ["5, 0, 0, +1/2", "5, 1, 0, +1/2", "5, 1, 1, +1/2", "6, 0, 0, +1/2"], a: 0 },
            { q: "Which of the following species has the smallest bond angle?", o: ["NH3", "PH3", "H2O", "H2S"], a: 3 },
            { q: "The correct order of increasing thermal stability of K2CO3, MgCO3, CaCO3, and BeCO3 is:", o: ["BeCO3 < MgCO3 < CaCO3 < K2CO3", "MgCO3 < BeCO3 < CaCO3 < K2CO3", "K2CO3 < MgCO3 < CaCO3 < BeCO3", "BeCO3 < MgCO3 < K2CO3 < CaCO3"], a: 0 },
            { q: "For the reaction N2(g) + 3H2(g) ⇌ 2NH3(g), the correct relationship between Kp and Kc is:", o: ["Kp = Kc (RT)⁻¹", "Kp = Kc (RT)⁻²", "Kp = Kc (RT)²", "Kp = Kc"], a: 1 },
            { q: "Identify the intensive property among the following:", o: ["Enthalpy", "Mass", "Volume", "Temperature"], a: 3 },
            { q: "The oxidation number of Mn in KMnO4 is:", o: ["+6", "+7", "+3", "+4"], a: 1 },
            { q: "The hybridisation of Carbon in graphite and diamond respectively is:", o: ["sp2, sp3", "sp3, sp3", "sp2, sp2", "sp3, sp2"], a: 0 },
            { q: "Which of the following is not a green house gas?", o: ["CO2", "CH4", "O3", "N2"], a: 3 },
            { q: "The conjugate base of H2PO4⁻ is:", o: ["HPO4²⁻", "PO4³⁻", "H3PO4", "H2P2O7"], a: 0 },
            { q: "Which of the following is diamagnetic?", o: ["O2", "O2⁻", "O2²⁻", "O2⁺"], a: 2 },
            { q: "The compressibility factor 'Z' for an ideal gas is:", o: ["Zero", "Less than 1", "Greater than 1", "Equal to 1"], a: 3 },
            { q: "In the extraction of Copper from its sulphide ore, the metal is formed by reduction of Cu2O with:", o: ["FeS", "CO", "Cu2S", "SO2"], a: 2 },
            { q: "Hydrogen bonding is strongest in:", o: ["HF", "H2O", "NH3", "HCl"], a: 0 },
            { q: "Which alkali metal ion has the highest hydration enthalpy?", o: ["Li⁺", "Na⁺", "K⁺", "Cs⁺"], a: 0 },

            // Class 11 Organic (16-25)
            { q: "The IUPAC name of neopentane is:", o: ["2-methylbutane", "2,2-dimethylpropane", "2-methylpropane", "2,2-dimethylbutane"], a: 1 },
            { q: "Heterolytic cleavage of C-Br bond results in the formation of:", o: ["Free radical", "Carbocation and Carbanion", "Carbocation and Bromide ion", "Carbanion and Bromonium ion"], a: 2 },
            { q: "Which of the following is most stable carbocation?", o: ["Methyl carbocation", "Primary carbocation", "Secondary carbocation", "Tertiary carbocation"], a: 3 },
            { q: "Benzene reacts with Chlorine in the presence of UV light to give:", o: ["Chlorobenzene", "Benzyl chloride", "Benzene hexachloride", "Hexachlorobenzene"], a: 2 },
            { q: "Ozonolysis of 2-butene gives:", o: ["Propanal", "Ethanal", "Methanal", "Butanal"], a: 1 },
            { q: "The presence of nitrogen in organic compounds is detected by:", o: ["Beilstein's test", "Lassaigne's test", "Dumas method", "Kjeldahl's method"], a: 1 },
            { q: "Which of the following is an electrophile?", o: ["H2O", "NH3", "AlCl3", "C2H5OH"], a: 2 },
            { q: "Friedel-Crafts alkylation of benzene with methyl chloride gives:", o: ["Chlorobenzene", "Toluene", "Phenol", "Aniline"], a: 1 },
            { q: "The main constituent of LPG is:", o: ["Methane", "Ethane", "Butane", "Propane"], a: 2 },
            { q: "Geometrical isomerism is not shown by:", o: ["1,1-dichloroethene", "1,2-dichloroethene", "2-butene", "2-pentene"], a: 0 },

            // Class 12 Physical (26-38)
            { q: "Which of the following is a network solid?", o: ["SO2", "I2", "Diamond", "H2O"], a: 2 },
            { q: "A 5% solution of cane sugar (M.W 342) is isotonic with 1% solution of substance X. The molecular weight of X is:", o: ["34.2", "171.2", "68.4", "136.8"], a: 2 },
            { q: "The Van't Hoff factor for BaCl2 at 0.01M concentration is 1.98. The percentage dissociation is:", o: ["49%", "69%", "89%", "98%"], a: 0 },
            { q: "During the electrolysis of molten NaCl, the product obtained at cathode is:", o: ["Cl2 gas", "Na metal", "H2 gas", "O2 gas"], a: 1 },
            { q: "The molar conductivity of an electrolyte increases as:", o: ["Dilution increases", "Dilution decreases", "Temperature decreases", "None of these"], a: 0 },
            { q: "For a first order reaction, the time required for 99.9% completion is about:", o: ["10 times t½", "100 times t½", "50 times t½", "Infinite"], a: 0 },
            { q: "The unit of rate constant for a zero order reaction is:", o: ["mol L⁻¹ s⁻¹", "s⁻¹", "L mol⁻¹ s⁻¹", "mol⁻¹ s⁻¹"], a: 0 },
            { q: "Adsorption of a gas on solid surface is generally:", o: ["Endothermic", "Exothermic", "Isothermic", "Adiabatic"], a: 1 },
            { q: "Tyndall effect is observed in:", o: ["True solution", "Colloidal solution", "Suspension", "Precipitate"], a: 1 },
            { q: "In the electrochemical cell: Zn|Zn²⁺||Cu²⁺|Cu, the negative electrode is:", o: ["Cu", "Zn", "Zn²⁺", "Cu²⁺"], a: 1 },
            { q: "Example of solid sol is:", o: ["Butter", "Gem stones", "Paints", "Cake"], a: 1 },
            { q: "Which of the following is an ore of Iron?", o: ["Bauxite", "Malachite", "Haematite", "Calamine"], a: 2 },
            { q: "Froth floatation process is used for the concentration of:", o: ["Oxide ores", "Sulphide ores", "Carbonate ores", "Chloride ores"], a: 1 },

            // Class 12 Inorganic (39-48)
            { q: "The most abundant noble gas in atmosphere is:", o: ["He", "Ne", "Ar", "Kr"], a: 2 },
            { q: "PCl5 is possible but NCl5 is not because:", o: ["Nitrogen is a gas", "Nitrogen has no d-orbitals", "Nitrogen is inert", "Chlorine is reactive"], a: 1 },
            { q: "Which of the following is a strong oxidizing agent?", o: ["F2", "Cl2", "Br2", "I2"], a: 0 },
            { q: "The catalyst used in Contact process for manufacture of H2SO4 is:", o: ["Fe", "V2O5", "Pt", "Ni"], a: 1 },
            { q: "Transition elements form colored ions due to:", o: ["d-d transition", "f-f transition", "Charge transfer", "Polarization"], a: 0 },
            { q: "The magnetic moment of a divalent ion in aqueous solution with atomic number 25 is:", o: ["5.92 BM", "4.90 BM", "2.84 BM", "3.87 BM"], a: 0 },
            { q: "Lanthanoid contraction is due to:", o: ["Poor shielding of 4f electrons", "Poor shielding of 5d electrons", "Effective shielding of 4f electrons", "Effective shielding of 5d electrons"], a: 0 },
            { q: "The oxidation state of Ni in [Ni(CO)4] is:", o: ["+2", "0", "+4", "+3"], a: 1 },
            { q: "Which of the following complexes exhibits Linkage isomerism?", o: ["[Co(NH3)5Cl]Cl2", "[Co(NH3)5NO2]Cl2", "[Co(en)3]Cl3", "[Pt(NH3)2Cl2]"], a: 1 },
            { q: "Which of the following is a hexadentate ligand?", o: ["Oxalate", "Ethylenediamine", "EDTA", "CN⁻"], a: 2 },

            // Class 12 Organic (49-60)
            { q: "Reaction of alkyl halide with sodium metal in dry ether is called:", o: ["Frankland reaction", "Wurtz reaction", "Fittig reaction", "Friedel-Crafts reaction"], a: 1 },
            { q: "Lucas reagent is a mixture of:", o: ["Conc. HCl and anhydrous ZnCl2", "Conc. HNO3 and anhydrous ZnCl2", "Conc. HCl and hydrous ZnCl2", "Conc. HNO3 and hydrous ZnCl2"], a: 0 },
            { q: "Phenol on treatment with Bromine water gives:", o: ["o-bromophenol", "p-bromophenol", "2,4,6-tribromophenol", "m-bromophenol"], a: 2 },
            { q: "Williamson's synthesis is used to prepare:", o: ["Alcohol", "Ketone", "Ether", "Amine"], a: 2 },
            { q: "Which of the following undergoes Aldol condensation?", o: ["Methanal", "Benzaldehyde", "Ethanal", "Trichloroethanal"], a: 2 },
            { q: "The product formed when acetone is reduced with Mg-Hg and water is:", o: ["Ethanol", "Propanol", "Pinacol", "Propane"], a: 2 },
            { q: "Carbylamine reaction is given by:", o: ["Primary amine", "Secondary amine", "Tertiary amine", "All of these"], a: 0 },
            { q: "Aniline on reaction with NaNO2 + HCl at 0-5°C gives:", o: ["Phenol", "Nitrobenzene", "Benzenediazonium chloride", "Chlorobenzene"], a: 2 },
            { q: "Vitamin B12 contains:", o: ["Fe", "Co", "Zn", "Mg"], a: 1 },
            { q: "The linkage present in proteins is:", o: ["Glycosidic", "Peptide", "Phosphodiester", "Hydrogen"], a: 1 },
            { q: "Natural rubber is a polymer of:", o: ["Chloroprene", "Isoprene", "Styrene", "Butadiene"], a: 1 },
            { q: "Which of the following is a non-narcotic analgesic?", o: ["Morphine", "Aspirin", "Codeine", "Heroin"], a: 1 }
        ];

        // --- 2. STATE VARIABLES ---
        let currentQ = 0;
        let answers = new Array(60).fill(null); // Stores user answers (index)
        let status = new Array(60).fill(0); // 0:Unread, 1:Visited, 2:Answered, 3:Review
        let timerTime = 80 * 60; // 80 mins in seconds
        let timerInterval;
        let isReviewMode = false;

        // --- 3. INIT ---
        window.onload = function() {
            renderPalette();
            loadQuestion(0);
            startTimer();
            status[0] = 1; // Visited first q
            updatePaletteBtn(0);
        };

        // --- 4. TIMER ---
        function startTimer() {
            timerInterval = setInterval(() => {
                timerTime--;
                let m = Math.floor(timerTime / 60);
                let s = timerTime % 60;
                document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                
                if (timerTime <= 0) {
                    clearInterval(timerInterval);
                    alert("Time's Up! Submitting automatically.");
                    submitTest();
                }
            }, 1000);
        }

        // --- 5. RENDER FUNCTIONS ---
        function loadQuestion(index) {
            currentQ = index;
            document.getElementById('q-num').innerText = index + 1;
            
            // Render Text
            document.getElementById('q-content').innerText = questions[index].q;
            
            // Render Options
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            questions[index].o.forEach((opt, i) => {
                const btn = document.createElement('div');
                let className = 'option-btn';
                
                // Normal Mode Styling
                if (!isReviewMode) {
                    if (answers[index] === i) className += ' selected';
                } 
                // Review Mode Styling
                else {
                    const correctIndex = questions[index].a;
                    const userIndex = answers[index];

                    if (i === correctIndex) {
                        className += ' correct-ans';
                    } else if (i === userIndex) {
                        className += ' wrong-ans';
                    }
                }
                
                btn.className = className;
                btn.innerHTML = `<div class="option-circle"></div> ${opt}`;
                
                // Only allow click if NOT in review mode
                if (!isReviewMode) {
                    btn.onclick = () => selectOption(i);
                }
                
                container.appendChild(btn);
            });

            // Update Nav Buttons
            document.getElementById('prev-btn').disabled = (index === 0);
            document.getElementById('next-btn').innerText = (index === 59) ? (isReviewMode ? 'Finish Review' : 'Submit') : 'Next';
            
            // Update status if unread
            if(status[index] === 0 && !isReviewMode) status[index] = 1;
            renderPalette();
        }

        function renderPalette() {
            const container = document.getElementById('palette-container');
            container.innerHTML = '';
            
            for(let i=0; i<60; i++) {
                const btn = document.createElement('div');
                btn.className = 'p-btn';
                btn.innerText = i + 1;
                
                // Set Color Class
                if(i === currentQ) btn.classList.add('current');
                
                if (isReviewMode) {
                    // Review Mode
                    if (answers[i] === questions[i].a) btn.classList.add('p-correct'); // Green
                    else if (answers[i] !== null) btn.classList.add('p-wrong'); // Red
                    else btn.classList.add('p-skip'); // Skipped
                } else {
                    // Test Mode
                    if(status[i] === 3) btn.classList.add(answers[i] !== null ? 'review-ans' : 'review');
                    else if(answers[i] !== null) btn.classList.add('answered');
                }
                
                btn.onclick = () => loadQuestion(i);
                container.appendChild(btn);
            }
        }

        function updatePaletteBtn(index) {
            renderPalette();
        }

        // --- 6. INTERACTION ---
        function selectOption(optIndex) {
            if(isReviewMode) return;
            answers[currentQ] = optIndex;
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.classList.remove('selected'));
            btns[optIndex].classList.add('selected');
        }

        function changeQuestion(dir) {
            // Save status for current
            if (!isReviewMode) {
                if (answers[currentQ] !== null) {
                    if(status[currentQ] !== 3) status[currentQ] = 2; // Answered
                } else {
                    if(status[currentQ] !== 3) status[currentQ] = 1; // Visited
                }
            }

            let next = currentQ + dir;
            if (next >= 0 && next < 60) {
                loadQuestion(next);
            } else if (next === 60) {
                if(isReviewMode) location.href = 'index.html';
                else submitTest();
            }
        }

        function markForReview() {
            if(isReviewMode) return;
            status[currentQ] = 3;
            changeQuestion(1);
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            sidebar.classList.toggle('open');
            if(sidebar.classList.contains('open')) overlay.style.display = 'block';
            else overlay.style.display = 'none';
        }

        // --- 7. SUBMISSION & REVIEW ---
        function submitTest() {
            clearInterval(timerInterval);
            let score = 0;
            let correct = 0;
            let wrong = 0;
            let unattempted = 0;

            for(let i=0; i<60; i++) {
                if(answers[i] === null) {
                    unattempted++;
                } else if(answers[i] === questions[i].a) {
                    score++;
                    correct++;
                } else {
                    wrong++;
                }
            }

            // Show Result
            document.getElementById('final-score').innerText = score;
            document.getElementById('correct-count').innerText = correct;
            document.getElementById('wrong-count').innerText = wrong;
            document.getElementById('unattempted-count').innerText = unattempted;
            
            let accuracy = (correct + wrong) > 0 ? Math.round((correct / (correct+wrong)) * 100) : 0;
            document.getElementById('accuracy-txt').innerText = accuracy + '%';

            // Animate Ring
            const pct = (score / 60) * 100;
            document.getElementById('score-ring').style.background = `conic-gradient(var(--success) ${pct}%, #eee 0)`;

            document.getElementById('result-overlay').style.display = 'flex';
        }

        function startReviewMode() {
            document.getElementById('result-overlay').style.display = 'none';
            isReviewMode = true;
            
            // UI Changes for Review Mode
            document.getElementById('submit-btn-top').style.display = 'none';
            document.getElementById('timer').innerText = "REVIEW";
            document.getElementById('timer').style.background = "#e2e6ea";
            document.getElementById('timer').style.color = "#333";
            document.getElementById('review-btn').style.display = 'none';
            document.getElementById('mark-badge').style.display = 'none';

            // Reset view to Q1 and render
            renderPalette();
            loadQuestion(0);
        }

    </script>
</body>
</html>