<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KCET Maths Mock Test</title>
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="theme-color" content="#d63384">
    <style>
        :root {
            --primary: #d63384; /* Pink for Math */
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            margin: 0; padding: 0; background: #f4f6f9; color: #333;
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
            user-select: none;
        }

        /* --- HEADER --- */
        .test-header {
            background: white; padding: 0 20px; border-bottom: 1px solid #ddd;
            display: flex; justify-content: space-between; align-items: center;
            height: 60px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 10;
        }
        .timer-box {
            font-size: 1.2rem; font-weight: bold; color: var(--danger);
            background: #fff0f0; padding: 5px 15px; border-radius: 5px; border: 1px solid #ffcccc;
            min-width: 80px; text-align: center;
        }
        .submit-btn {
            background: var(--success); color: white; border: none; padding: 10px 20px;
            border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .submit-btn:hover { background: #218838; }

        /* --- MAIN LAYOUT --- */
        .test-container {
            display: flex; flex: 1; overflow: hidden; position: relative;
        }

        /* Question Area */
        .question-area {
            flex: 1; padding: 20px; overflow-y: auto;
            display: flex; flex-direction: column; max-width: 100%;
        }
        .q-card {
            background: white; padding: 25px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }
        .q-header {
            display: flex; justify-content: space-between; margin-bottom: 15px;
            border-bottom: 1px solid #eee; padding-bottom: 10px;
        }
        .q-badge {
            background: var(--primary); color: white; padding: 2px 8px; 
            border-radius: 4px; font-size: 0.8rem; font-weight: bold;
        }
        .q-text { font-size: 1.15rem; font-weight: 600; margin-bottom: 25px; line-height: 1.6; }
        
        /* Options */
        .option-btn {
            display: flex; align-items: center; width: 100%; text-align: left; padding: 15px;
            margin-bottom: 12px; border: 2px solid #eee; border-radius: 8px;
            background: white; cursor: pointer; transition: 0.2s;
            font-size: 1rem; position: relative;
        }
        .option-btn:hover { background: #f8f9fa; border-color: #ccc; }
        
        /* Selection State (During Test) */
        .option-btn.selected { 
            border-color: var(--primary); background: #fce4ec; color: var(--primary); font-weight: 600; 
        }

        /* Review Mode States */
        .option-btn.correct-ans {
            border-color: var(--success); background: #d4edda; color: #155724; font-weight: bold;
        }
        .option-btn.correct-ans::after { content: ' (Correct Answer)'; font-size: 0.8rem; margin-left: auto; font-weight: normal; color: #155724; }
        
        .option-btn.wrong-ans {
            border-color: var(--danger); background: #f8d7da; color: #721c24; font-weight: bold;
        }
        .option-btn.wrong-ans::after { content: ' (Your Answer)'; font-size: 0.8rem; margin-left: auto; font-weight: normal; color: #721c24; }

        .option-circle {
            width: 24px; height: 24px; border: 2px solid #ccc; border-radius: 50%;
            margin-right: 15px; display: flex; justify-content: center; align-items: center;
        }
        .option-btn.selected .option-circle {
            border-color: var(--primary); background: var(--primary);
        }
        .option-btn.selected .option-circle::after {
            content: '✓'; color: white; font-size: 0.8rem;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: auto; padding-top: 10px;
        }
        .nav-btn {
            padding: 12px 25px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold;
            background: #6c757d; color: white; transition: 0.2s;
        }
        .nav-btn.next { background: var(--primary); }
        .nav-btn:hover { opacity: 0.9; }
        .nav-btn:disabled { background: #e9ecef; color: #adb5bd; cursor: not-allowed; }

        /* Sidebar (Question Palette) */
        .sidebar {
            width: 320px; background: white; border-left: 1px solid #ddd;
            display: flex; flex-direction: column; transition: transform 0.3s ease;
            position: relative; z-index: 20;
        }
        .sidebar-header {
            padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee;
            font-weight: bold; text-align: center; color: #555;
        }
        
        /* Legend */
        .legend {
            display: flex; justify-content: space-around; padding: 10px; border-bottom: 1px solid #eee; font-size: 0.75rem;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        
        .palette-grid {
            padding: 15px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
            overflow-y: auto; flex: 1; align-content: start;
        }
        .p-btn {
            width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ddd;
            background: white; cursor: pointer; font-weight: bold; color: #555;
            display: flex; justify-content: center; align-items: center; font-size: 0.9rem;
        }
        .p-btn:hover { background: #f0f0f0; }
        
        /* Palette States */
        .p-btn.current { border: 2px solid var(--primary); color: var(--primary); }
        .p-btn.answered { background: var(--success); color: white; border-color: var(--success); }
        .p-btn.review { background: var(--warning); color: black; border-color: var(--warning); }
        .p-btn.review-ans { background: #6610f2; color: white; border-color: #6610f2; }

        /* Review Mode Palette */
        .p-btn.p-correct { background: var(--success); color: white; border-color: var(--success); }
        .p-btn.p-wrong { background: var(--danger); color: white; border-color: var(--danger); }
        .p-btn.p-skip { background: #e9ecef; color: #666; }

        /* Mobile Toggle */
        .mobile-toggle { display: none; background: transparent; border: none; font-size: 1.5rem; cursor: pointer; }
        .mobile-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 15;
        }

        /* RESULT OVERLAY */
        #result-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: white; z-index: 100; display: none;
            flex-direction: column; align-items: center; justify-content: center; overflow-y: auto; padding: 20px;
        }
        .score-card {
            background: white; padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center;
            border: 1px solid #eee; width: 90%; max-width: 450px;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: auto;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .score-circle {
            width: 140px; height: 140px; border-radius: 50%;
            background: conic-gradient(var(--success) 0%, #eee 0); 
            display: flex; justify-content: center; align-items: center;
            margin: 0 auto 25px; position: relative;
        }
        .score-inner {
            width: 120px; height: 120px; background: white; border-radius: 50%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .score-big { font-size: 2.5rem; font-weight: 800; color: var(--dark); }
        .score-total { font-size: 0.9rem; color: #666; }

        .stat-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;
        }
        .stat-box {
            background: #f8f9fa; padding: 15px; border-radius: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed; right: -320px; top: 60px; bottom: 0; height: calc(100% - 60px);
            }
            .sidebar.open { transform: translateX(-320px); }
            .mobile-toggle { display: block; }
            .test-header { padding: 0 10px; }
            .timer-box { font-size: 1rem; min-width: 60px; padding: 5px 10px; }
            .submit-btn { padding: 8px 15px; font-size: 0.9rem; }
            .mobile-overlay.active { display: block; }
        }

    </style>
</head>
<body>

    <div class="test-header">
        <div style="display:flex; align-items:center;">
            <a href="index.html" onclick="if(!isReviewMode) return confirm('Exit test? Progress will be lost.');" style="text-decoration:none; color:#333; margin-right:15px; font-weight:bold; font-size: 1.2rem;">✕</a>
            <h3 style="margin:0; font-size:1.1rem; display: flex; flex-direction: column;">
                <span>Mathematics</span>
                <span style="font-size:0.7rem; color:#666; font-weight:normal;">Paper III</span>
            </h3>
        </div>
        
        <div class="timer-box" id="timer">80:00</div>
        
        <div style="display:flex; gap:15px; align-items: center;">
            <button class="submit-btn" id="submit-btn-top" onclick="submitTest()">Submit</button>
            <button class="mobile-toggle" onclick="toggleSidebar()">☰</button>
        </div>
    </div>

    <div class="mobile-overlay" onclick="toggleSidebar()"></div>

    <div class="test-container">
        
        <div class="question-area">
            <div class="q-card">
                <div class="q-header">
                    <span style="color:#666; font-weight:600;">Question <span id="q-num">1</span> of 60</span>
                    <span class="q-badge" id="mark-badge">+1 Mark</span>
                </div>
                <div class="q-text" id="q-content">Loading Question...</div>
                <div id="options-container">
                    </div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn" id="prev-btn" onclick="changeQuestion(-1)">Previous</button>
                <button class="nav-btn" id="review-btn" style="background: #ffc107; color: #000;" onclick="markForReview()">Mark for Review</button>
                <button class="nav-btn next" id="next-btn" onclick="changeQuestion(1)">Save & Next</button>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">Question Palette</div>
            <div class="legend">
                <div class="legend-item"><div class="dot" style="background:var(--success)"></div> Ans</div>
                <div class="legend-item"><div class="dot" style="background:white; border:1px solid #ddd"></div> Unread</div>
                <div class="legend-item"><div class="dot" style="background:var(--warning)"></div> Review</div>
            </div>
            <div class="palette-grid" id="palette-container">
                </div>
        </div>
    </div>

    <div id="result-overlay">
        <div class="score-card">
            <h2 style="margin:0 0 20px 0; color:var(--dark);">Test Summary</h2>
            
            <div class="score-circle" id="score-ring">
                <div class="score-inner">
                    <span class="score-big" id="final-score">0</span>
                    <span class="score-total">/ 60</span>
                </div>
            </div>

            <div class="stat-grid">
                <div class="stat-box">
                    <div style="color:var(--success); font-weight:bold; font-size:1.2rem;" id="correct-count">0</div>
                    <div style="font-size:0.8rem; color:#666;">Correct</div>
                </div>
                <div class="stat-box">
                    <div style="color:var(--danger); font-weight:bold; font-size:1.2rem;" id="wrong-count">0</div>
                    <div style="font-size:0.8rem; color:#666;">Wrong</div>
                </div>
                <div class="stat-box">
                    <div style="color:#666; font-weight:bold; font-size:1.2rem;" id="unattempted-count">0</div>
                    <div style="font-size:0.8rem; color:#666;">Skipped</div>
                </div>
                <div class="stat-box">
                    <div style="color:var(--primary); font-weight:bold; font-size:1.2rem;" id="accuracy-txt">0%</div>
                    <div style="font-size:0.8rem; color:#666;">Accuracy</div>
                </div>
            </div>

            <button class="submit-btn" style="width:100%; margin-top:20px; padding:15px; background:var(--primary);" onclick="startReviewMode()">View Detailed Analysis</button>
            <button class="submit-btn" style="width:100%; margin-top:10px; padding:15px; background:white; color:var(--dark); border:1px solid #ddd;" onclick="location.href='index.html'">Return to Dashboard</button>
        </div>
    </div>

    <script>
        // --- 1. REAL KCET MATH QUESTIONS (60 QUESTIONS) ---
        const questions = [
            // Sets & Relations (1-5)
            { q: "If A = {1, 2, 3}, the number of equivalence relations containing (1, 2) is:", o: ["1", "2", "3", "4"], a: 1 },
            { q: "If f: R → R is defined by f(x) = x² + 1, then the pre-image of 17 is:", o: ["{4, -4}", "{3, -3}", "{-4}", "{4}"], a: 0 },
            { q: "If A = {1, 2, 3, 4}, then the number of subsets of A is:", o: ["12", "14", "16", "15"], a: 2 },
            { q: "If R is a relation on Set A such that (a,b) ∈ R and (b,a) ∈ R implies a = b, then R is:", o: ["Reflexive", "Symmetric", "Anti-symmetric", "Transitive"], a: 2 },
            { q: "The domain of sin⁻¹(2x) is:", o: ["[0, 1]", "[-1, 1]", "[-1/2, 1/2]", "[-2, 2]"], a: 2 },

            // Trig & Complex Numbers (6-10)
            { q: "The value of cos(22.5°) is:", o: ["√(2+√2)/2", "√(2-√2)/2", "√(2+√2)/4", "None"], a: 0 },
            { q: "If tan A = 1/2, tan B = 1/3, then A + B is:", o: ["π/3", "π/4", "π/6", "π/2"], a: 1 },
            { q: "The modulus of (1 + i)/(1 - i) is:", o: ["1", "2", "0", "√2"], a: 0 },
            { q: "The value of i + i² + i³ + i⁴ is:", o: ["1", "-1", "i", "0"], a: 3 },
            { q: "The principal argument of -1 - i is:", o: ["π/4", "3π/4", "-3π/4", "-π/4"], a: 2 },

            // Matrices & Determinants (11-15)
            { q: "If A is a square matrix such that A² = A, then (I + A)³ - 7A is equal to:", o: ["A", "I - A", "I", "3A"], a: 2 },
            { q: "If matrix A is both symmetric and skew-symmetric, then:", o: ["A is diagonal", "A is zero matrix", "A is identity", "None"], a: 1 },
            { q: "The value of determinant | cos x  -sin x | \n | sin x   cos x | is:", o: ["0", "1", "-1", "sin 2x"], a: 1 },
            { q: "If A is an invertible matrix of order 2, then det(A⁻¹) is equal to:", o: ["det(A)", "1/det(A)", "1", "0"], a: 1 },
            { q: "The system of equations x+y=2, 2x+2y=3 has:", o: ["Unique solution", "No solution", "Infinitely many", "None"], a: 1 },

            // Continuity & Differentiation (16-25)
            { q: "If f(x) = |x|, then f(x) is:", o: ["Continuous everywhere", "Differentiable everywhere", "Not continuous at 0", "None"], a: 0 },
            { q: "The derivative of sin(x²) with respect to x is:", o: ["cos(x²)", "2x cos(x²)", "cos(2x)", "2x sin(x²)"], a: 1 },
            { q: "If y = log(log x), then dy/dx is:", o: ["1/(x log x)", "1/log x", "1/x", "log x/x"], a: 0 },
            { q: "The derivative of eˣ w.r.t √x is:", o: ["2√x eˣ", "eˣ/2√x", "eˣ", "√x eˣ"], a: 0 },
            { q: "If x = at², y = 2at, then dy/dx is:", o: ["1/t", "t", "-1/t²", "1/t²"], a: 0 },
            { q: "Rolle's theorem is applicable for f(x) = x² in [-1, 1]. The value of c is:", o: ["1", "-1", "0", "0.5"], a: 2 },
            { q: "The function f(x) = x³ - 3x² + 4x is increasing in:", o: ["R", "(0, 1)", "(1, ∞)", "None"], a: 0 },
            { q: "The slope of normal to the curve y = 2x² + 3 sin x at x = 0 is:", o: ["3", "1/3", "-3", "-1/3"], a: 3 },
            { q: "The rate of change of area of a circle with respect to its radius r at r = 6cm is:", o: ["10π", "12π", "8π", "11π"], a: 1 },
            { q: "Maximum value of sin x + cos x is:", o: ["1", "2", "√2", "1/√2"], a: 2 },

            // Integrals (26-35)
            { q: "∫ eˣ (tan x + log sec x) dx is:", o: ["eˣ tan x + C", "eˣ log sec x + C", "eˣ sec x + C", "None"], a: 1 },
            { q: "∫ dx / (x² + a²) is:", o: ["1/a tan⁻¹(x/a)", "tan⁻¹(x/a)", "sin⁻¹(x/a)", "1/a log(x+a)"], a: 0 },
            { q: "Value of ∫(0 to π/2) sin²x dx is:", o: ["π/2", "π/4", "π", "0"], a: 1 },
            { q: "Value of ∫(0 to 1) dx / (1 + x²) is:", o: ["π/4", "π/2", "π", "1"], a: 0 },
            { q: "∫ log x dx is equal to:", o: ["x log x - x + C", "x log x + C", "log x - x + C", "1/x + C"], a: 0 },
            { q: "Area bounded by y = x, x-axis and x=0, x=2 is:", o: ["2", "4", "1", "0.5"], a: 0 },
            { q: "Area of the circle x² + y² = 16 is:", o: ["16π", "4π", "8π", "2π"], a: 0 },
            { q: "Order and degree of differential equation d²y/dx² + (dy/dx)³ + y = 0 are:", o: ["2, 1", "2, 3", "1, 2", "3, 2"], a: 0 },
            { q: "General solution of dy/dx = eˣ⁻ʸ is:", o: ["eˣ - eʸ = C", "eˣ + eʸ = C", "e⁻ˣ + eʸ = C", "None"], a: 0 },
            { q: "Integrating factor of dy/dx + y/x = x² is:", o: ["x", "log x", "1/x", "eˣ"], a: 0 },

            // Vectors & 3D (36-45)
            { q: "The projection of vector i - j on i + j is:", o: ["0", "1", "√2", "1/√2"], a: 0 },
            { q: "If |a|=2, |b|=3 and a.b=4, then |a-b| is:", o: ["√5", "√6", "√2", "1"], a: 0 },
            { q: "The angle between two vectors a and b with magnitudes 1 and 2 respectively and a.b = 1 is:", o: ["60°", "30°", "90°", "45°"], a: 0 },
            { q: "A unit vector perpendicular to both i + j and j + k is:", o: ["(i - j + k)/√3", "(i + j + k)/√3", "(i - j - k)/√3", "None"], a: 0 },
            { q: "The direction cosines of z-axis are:", o: ["0, 0, 1", "1, 0, 0", "0, 1, 0", "1, 1, 1"], a: 0 },
            { q: "Distance of point (1, 2, 3) from origin is:", o: ["√6", "√14", "√10", "6"], a: 1 },
            { q: "Equation of plane passing through (1, 0, 0), (0, 1, 0), (0, 0, 1) is:", o: ["x+y+z=1", "x+y+z=0", "x+y+z=3", "None"], a: 0 },
            { q: "If a line makes angles 90°, 60°, 30° with axes, is it possible?", o: ["Yes", "No", "Maybe", "Only in 4D"], a: 1 },
            { q: "The angle between two planes 2x + y - 2z = 5 and 3x - 6y - 2z = 7 is:", o: ["cos⁻¹(4/21)", "cos⁻¹(8/21)", "90°", "60°"], a: 0 },
            { q: "The distance between parallel planes 2x - 2y + z + 3 = 0 and 4x - 4y + 2z + 5 = 0 is:", o: ["1/6", "1/2", "1/3", "1"], a: 0 },

            // Probability & LPP (46-55)
            { q: "If P(A) = 0.4, P(B) = 0.8, P(B|A) = 0.6, then P(A∩B) is:", o: ["0.24", "0.32", "0.48", "0.96"], a: 0 },
            { q: "If A and B are independent events, P(A)=0.3, P(B)=0.4, then P(A∩B) is:", o: ["0.12", "0.7", "0.1", "0.5"], a: 0 },
            { q: "A coin is tossed 3 times. Probability of getting exactly 2 heads is:", o: ["3/8", "1/2", "1/4", "5/8"], a: 0 },
            { q: "Mean of a binomial distribution with n=10, p=0.4 is:", o: ["4", "2.4", "6", "5"], a: 0 },
            { q: "Maximum value of Z = 3x + 4y subject to x+y ≤ 4, x≥0, y≥0 is:", o: ["16", "12", "4", "0"], a: 0 },
            { q: "In LPP, the objective function is always:", o: ["Linear", "Quadratic", "Cubic", "Constant"], a: 0 },
            { q: "The feasible region for x ≥ 0, y ≥ 0 is:", o: ["1st Quadrant", "2nd Quadrant", "3rd Quadrant", "4th Quadrant"], a: 0 },
            { q: "Probability of getting a sum 9 in a single throw of two dice is:", o: ["1/9", "1/12", "1/6", "1/36"], a: 0 },
            { q: "If A and B are mutually exclusive, P(A∩B) is:", o: ["0", "1", "0.5", "P(A)P(B)"], a: 0 },
            { q: "Bayes' theorem is used to find:", o: ["Reverse Probability", "Forward Probability", "Conditional Probability", "None"], a: 0 },

            // Class 11 Algebra (56-60)
            { q: "The number of terms in expansion of (x + a)⁵⁰ is:", o: ["50", "51", "49", "100"], a: 1 },
            { q: "The 10th term of AP: 2, 7, 12... is:", o: ["47", "45", "50", "52"], a: 0 },
            { q: "Sum of first n natural numbers is:", o: ["n(n+1)/2", "n²", "n(n+1)", "n(n+1)(2n+1)/6"], a: 0 },
            { q: "Value of ⁵P₃ is:", o: ["60", "20", "10", "15"], a: 0 },
            { q: "Slope of line passing through (3, -2) and (3, 4) is:", o: ["Undefined", "0", "1", "-1"], a: 0 }
        ];

        // --- 2. STATE VARIABLES ---
        let currentQ = 0;
        let answers = new Array(60).fill(null); // Stores user answers (index)
        let status = new Array(60).fill(0); // 0:Unread, 1:Visited, 2:Answered, 3:Review
        let timerTime = 80 * 60; // 80 mins in seconds
        let timerInterval;
        let isReviewMode = false;

        // --- 3. INIT ---
        window.onload = function() {
            renderPalette();
            loadQuestion(0);
            startTimer();
            status[0] = 1; // Visited first q
            updatePaletteBtn(0);
        };

        // --- 4. TIMER ---
        function startTimer() {
            timerInterval = setInterval(() => {
                timerTime--;
                let m = Math.floor(timerTime / 60);
                let s = timerTime % 60;
                document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                
                if (timerTime <= 0) {
                    clearInterval(timerInterval);
                    alert("Time's Up! Submitting automatically.");
                    submitTest();
                }
            }, 1000);
        }

        // --- 5. RENDER FUNCTIONS ---
        function loadQuestion(index) {
            currentQ = index;
            document.getElementById('q-num').innerText = index + 1;
            
            // Render Text
            document.getElementById('q-content').innerText = questions[index].q;
            
            // Render Options
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            questions[index].o.forEach((opt, i) => {
                const btn = document.createElement('div');
                let className = 'option-btn';
                
                // Normal Mode Styling
                if (!isReviewMode) {
                    if (answers[index] === i) className += ' selected';
                } 
                // Review Mode Styling
                else {
                    const correctIndex = questions[index].a;
                    const userIndex = answers[index];

                    if (i === correctIndex) {
                        className += ' correct-ans';
                    } else if (i === userIndex) {
                        className += ' wrong-ans';
                    }
                }
                
                btn.className = className;
                btn.innerHTML = `<div class="option-circle"></div> ${opt}`;
                
                // Only allow click if NOT in review mode
                if (!isReviewMode) {
                    btn.onclick = () => selectOption(i);
                }
                
                container.appendChild(btn);
            });

            // Update Nav Buttons
            document.getElementById('prev-btn').disabled = (index === 0);
            document.getElementById('next-btn').innerText = (index === 59) ? (isReviewMode ? 'Finish Review' : 'Submit') : 'Next';
            
            // Update status if unread
            if(status[index] === 0 && !isReviewMode) status[index] = 1;
            renderPalette();
        }

        function renderPalette() {
            const container = document.getElementById('palette-container');
            container.innerHTML = '';
            
            for(let i=0; i<60; i++) {
                const btn = document.createElement('div');
                btn.className = 'p-btn';
                btn.innerText = i + 1;
                
                // Set Color Class
                if(i === currentQ) btn.classList.add('current');
                
                if (isReviewMode) {
                    // Review Mode
                    if (answers[i] === questions[i].a) btn.classList.add('p-correct'); // Green
                    else if (answers[i] !== null) btn.classList.add('p-wrong'); // Red
                    else btn.classList.add('p-skip'); // Skipped
                } else {
                    // Test Mode
                    if(status[i] === 3) btn.classList.add(answers[i] !== null ? 'review-ans' : 'review');
                    else if(answers[i] !== null) btn.classList.add('answered');
                }
                
                btn.onclick = () => loadQuestion(i);
                container.appendChild(btn);
            }
        }

        function updatePaletteBtn(index) {
            renderPalette();
        }

        // --- 6. INTERACTION ---
        function selectOption(optIndex) {
            if(isReviewMode) return;
            answers[currentQ] = optIndex;
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.classList.remove('selected'));
            btns[optIndex].classList.add('selected');
        }

        function changeQuestion(dir) {
            // Save status for current
            if (!isReviewMode) {
                if (answers[currentQ] !== null) {
                    if(status[currentQ] !== 3) status[currentQ] = 2; // Answered
                } else {
                    if(status[currentQ] !== 3) status[currentQ] = 1; // Visited
                }
            }

            let next = currentQ + dir;
            if (next >= 0 && next < 60) {
                loadQuestion(next);
            } else if (next === 60) {
                if(isReviewMode) location.href = 'index.html';
                else submitTest();
            }
        }

        function markForReview() {
            if(isReviewMode) return;
            status[currentQ] = 3;
            changeQuestion(1);
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            sidebar.classList.toggle('open');
            if(sidebar.classList.contains('open')) overlay.style.display = 'block';
            else overlay.style.display = 'none';
        }

        // --- 7. SUBMISSION & REVIEW ---
        function submitTest() {
            clearInterval(timerInterval);
            let score = 0;
            let correct = 0;
            let wrong = 0;
            let unattempted = 0;

            for(let i=0; i<60; i++) {
                if(answers[i] === null) {
                    unattempted++;
                } else if(answers[i] === questions[i].a) {
                    score++;
                    correct++;
                } else {
                    wrong++;
                }
            }

            // Show Result
            document.getElementById('final-score').innerText = score;
            document.getElementById('correct-count').innerText = correct;
            document.getElementById('wrong-count').innerText = wrong;
            document.getElementById('unattempted-count').innerText = unattempted;
            
            let accuracy = (correct + wrong) > 0 ? Math.round((correct / (correct+wrong)) * 100) : 0;
            document.getElementById('accuracy-txt').innerText = accuracy + '%';

            // Animate Ring
            const pct = (score / 60) * 100;
            document.getElementById('score-ring').style.background = `conic-gradient(var(--success) ${pct}%, #eee 0)`;

            document.getElementById('result-overlay').style.display = 'flex';
        }

        function startReviewMode() {
            document.getElementById('result-overlay').style.display = 'none';
            isReviewMode = true;
            
            // UI Changes for Review Mode
            document.getElementById('submit-btn-top').style.display = 'none';
            document.getElementById('timer').innerText = "REVIEW";
            document.getElementById('timer').style.background = "#e2e6ea";
            document.getElementById('timer').style.color = "#333";
            document.getElementById('review-btn').style.display = 'none';
            document.getElementById('mark-badge').style.display = 'none';

            // Reset view to Q1 and render
            renderPalette();
            loadQuestion(0);
        }

    </script>
</body>
</html>